#:import MapView kivy.garden.mapview.MapView
#:import GpsBlinker gpsblinker.GpsBlinker
#:include gpsblinker.kv

<SettingsButton>:
    icon: "settings"
    pos_hint: {"top": 0.95, "x": 0.05}
    height: self.width
    on_release: app.root.nav_drawer.set_state("open")
    md_bg_color: app.theme_cls.primary_color
            
<ItemDrawer>:   
    on_release: 
        self.parent.set_color_item(self)
        app.root.windows.current = self.text
        app.root.windows.current_screen.manager.transition.direction = "right"
        app.root.nav_drawer.set_state("close")
    
    IconLeftWidget:
        id: icon
        icon: root.icon
        
<ContentNavigationDrawer>:
    orientation: "vertical"
    padding: "8dp"
    spacing: "8dp"
    

    AnchorLayout:
        anchor_x: "left"
        size_hint_y: None
        height: avatar.height

        Image:
            id: avatar
            size_hint: None, None
            size: "56dp", "56dp"
            source: "data/logo/kivy-icon-256.png"

    MDLabel:
        text: "Settings"
        font_style: "Button"
        size_hint_y: None
        height: self.texture_size[1]
        theme_text_color: "Secondary"
       

    MDLabel:
        text: "triproulette@gmail.com"
        font_style: "Caption"
        size_hint_y: None
        height: self.texture_size[1]
        theme_text_color: "Secondary"
        
    ScrollView:

        DrawerList:
            id: md_list

    # MDToolbar:
    #     title: "Navigation Drawer"
    #     elevation: 10
    #     left_action_items: [['menu', lambda x: nav_drawer.toggle_nav_drawer()]]

<PageToolbar>
    right_action_items: [["keyboard-return", lambda x: app.return_homepage()]]
    md_bg_color: app.theme_cls.accent_color
    pos_hint: {"top": 1}

<DetailsPage>
    
    name: "Account Details"
    PageToolbar:
        title: root.name
    
<FormPage>
    name: "Form"
    PageToolbar:
        title: root.name

<LogPage>
    name: "Log Out/Log In"
    PageToolbar:
        title: root.name

<HelpPage>
    name: "Help"    
    PageToolbar:
        title: root.name

MainScreen:
    nav_drawer: nav_drawer
    windows: windows
    homepage: homepage

    NavigationLayout:
        id: nav_layout
    
        WindowManager:
            id: windows

            HomePage:
                id: homepage

            FormPage:
                id: formpage
            DetailsPage:
                id: detailspage
            HelpPage:
                id: helppage
            LogPage:
                id: logpage

        MDNavigationDrawer:
            id: nav_drawer

            ContentNavigationDrawer:
                id: content_drawer

<MapView>:
    zoom: 2
    GpsBlinker:
        id: blinker

<Content>:
    orientation: "vertical"
    spacing: "12dp"
    size_hint_y: None
    height: "120dp"

    MDLabel:
        text: "Food:"
        font_style: "Caption"
    MDSwitch:
        on_active: app.on_switch_active
    MDLabel:
        text: "Trip Length:"
        font_style: "Caption"

<HomePage>:
    name: "HomePage"
    map: mapview
    MapView:
        id: mapview

    FloatLayout:

        SettingsButton:
        
        MDRaisedButton:
            text: "Generate Trip"
            md_bg_color: app.theme_cls.primary_dark
            pos_hint: {"center_x": 0.5, "y": 0.03}
            size_hint: 0.8, 0.1
            on_release: root.show_confirmation_dialog()

        MDRoundFlatButton:
            text: "Log In"
            text_color: app.theme_cls.primary_color
            pos_hint: {"center_x": 0.25, "y": 0.15}
            size: account_create.size

        MDRoundFlatButton:
            id: account_create
            text: "Create Account"
            text_color: app.theme_cls.primary_color
            pos_hint: {"center_x": 0.75, "y": 0.15}
            
        MDIconButton:
            icon: "crosshairs-gps"
            pos_hint: {"y": 0.25, "right": 0.9}
            height: self.width
            md_bg_color: app.theme_cls.primary_color
            
        MDFloatingActionButtonSpeedDial:
            data: app.data
            rotation_root_button: True
            md_bg_color: app.theme_cls.primary_dark  
            hint_animation:  True
            callback: root.toast_pop