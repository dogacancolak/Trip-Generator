#:kivy 1.11.1

#:import MapView kivy.garden.mapview.MapView
#:import MapSource kivy.garden.mapview.MapSource
#:import GpsBlinker gpsblinker.GpsBlinker
#:include gpsblinker.kv
#:import Toast kivymd.toast

<HomeMapView>:
    zoom: 15
    double_tap_zoom: True
    map_source: MapSource(min_zoom=10, max_zoom=15)
    GpsBlinker:
        id: blinker
    
<FoodOption>:
    orientation: "vertical"
    title: "Set on Usage" # set title when used
    Label:
        text: root.title
        text_color: 0, 0, 0, 1
        size_hint: 1, 0.5
    MDCheckbox:
        title: root.title
        on_active: root.update_food_options(*args)
        size_hint: None, 0.5
        width: self.height
        pos_hint: {'center_x': .5}
        active: True

<DialogContent>:
    orientation: "vertical"
    spacing: "12dp"
    height: "120dp"
    
    GridLayout:
        cols: 3
        FoodOption:
            title: "Restaurants"
        FoodOption:
            title: "Bars"
        FoodOption:
            title: "Cafes"

    GridLayout:
        cols: 3
        Label:
            id: duration_label
            text: "Trip Duration:" 
        MDSlider:
            id: duration_slider
            min: 1
            max: 6
            value: 2
            hint: False
            on_value: root.update_slider_values(self, self.value, "duration")
        Label:
            hour: ' hours' if round(duration_slider.value) > 1 else ' hour'
            text: str(round(duration_slider.value)) + self.hour

    GridLayout:
        cols: 3
        Label:
            text: "Budget:"
        MDSlider:
            id: budget_slider
            min: 1
            max: 5
            value: 3
            on_value: root.update_slider_values(self, self.value, "budget")
        FloatLayout:
            MDFillRoundFlatButton:
                text: "Generate"
                size_hint: 0.8, 0.6
                pos_hint: {'center_x': .5, 'center_y': .5}
                on_release:
                    if app.user_info.interests or app.user_info.food: app.root.routepage.generate()
                    else: app.root.homepage.toast_pop()

<PopupDialog>:
    title_align: 'center'
    title_size: '18sp'
    separator_color: app.theme_cls.primary_color
    size_hint: 0.7, 0.4
    pos_hint: {"center_x": 0.5, "center_y": 0.5}
    
<SettingsButton>:
    icon: "settings"
    pos_hint: {"top": 0.95, "x": 0.05}
    height: self.width
    on_release: app.root.nav_drawer.set_state("open")
    md_bg_color: 0, 0, 0, 0
    canvas.before:
        Color:
            rgba: app.theme_cls.primary_dark
        RoundedRectangle:
            radius: [self.width/2.0, ]
            size: [self.width * 1.05, self.height * 1.05]
            pos: [self.x - self.width * .05 / 2, self.y - self.height * .05 / 2]
        Color:
            rgba: app.theme_cls.primary_color
        RoundedRectangle:
            radius: [self.width/2.0, ]
            size: self.size
            pos: self.pos


<SearchCircle>:
    canvas:
        Color: 
            rgba: app.theme_cls.primary_dark[:3] + [0.3]
        RoundedRectangle: 
            group: 'a'
            size:(self.width/2, self.width/2)
            pos: (self.width / 4, root.height/2 - self.width / 4)
            radius:[self.width/2,]

        Color: 
            rgba: app.theme_cls.primary_dark
        RoundedRectangle: 
            group: 'b'
            size:(self.width/48, self.width/48)
            pos: (self.width / 2 - self.width / 96, root.height/2 - self.width / 96)
            radius:[self.width/48,]

<HomePage>:
    name: "HomePage"
    map: mapview
    circle: circle

    HomeMapView:
        id: mapview

    FloatLayout:
    
        SearchCircle:
            id: circle

        SettingsButton:
            height: gps.height
            width:  gps.width
            pos_x: 20

        MDFillRoundFlatButton:            
            md_bg_color: app.theme_cls.primary_color
            pos_hint: {"center_x": 0.5, "y": 0.025}
            size_hint: 0.55, 0.07
            on_release: app.user_info.lat = mapview.lat; app.user_info.lon = mapview.lon; circle.set_search_radius(); root.show_confirmation_dialog()
           
            Label:
                font_size: "22sp"
                text: "Generate Trip"
                
        # MDRoundFlatButton:
        #     text: "Log In"
        #     text_color: app.theme_cls.primary_color
        #     pos_hint: {"center_x": 0.25, "y": 0.15}
        #     size: account_create.size

        # MDRoundFlatButton:
        #     id: account_create
        #     text: "Create Account"
        #     text_color: app.theme_cls.primary_color
        #     pos_hint: {"center_x": 0.75, "y": 0.15}
            
        MDIconButton:
            id: gps
            icon: "crosshairs-gps"
            height: "44pt"
            pos: "14pt", "14pt"
            width: self.height 
            on_release: mapview.center_on(app.user_info.gps_lat, app.user_info.gps_lon)
            md_bg_color: 0, 0, 0, 0
            canvas.before:
                Color:
                    rgba: app.theme_cls.primary_dark
                RoundedRectangle:
                    radius: [self.width/2.0, ]
                    size: [self.width * 1.05, self.height * 1.05]
                    pos: [self.x - self.width * .05 / 2, self.y - self.height * .05 / 2]
                Color:
                    rgba: app.theme_cls.primary_color
                RoundedRectangle:
                    radius: [self.width/2.0, ]
                    size: [self.width, self.height]
                    pos: [self.x, self.y]

        TransportOptions:
            id: transport
            data: {'bicycle': '', 'car': '', 'walk': '', 'bus': ''}
            md_bg_color: app.theme_cls.primary_dark  
            callback: self.update_transport
            pos_hint: {"center_y": 0.5}
            icon: 'walk'
